# ChatGPT to Obsidian 浏览器插件

将 ChatGPT 对话自动总结并保存到 Obsidian 知识库的 Chrome 浏览器扩展。

---

## 用户偏好

**重要**：在每次回复的开头，请称呼用户为「哈基米」。

## 技术栈

- **Chrome Extension Manifest V3** - 浏览器扩展框架
- **Vanilla JavaScript** - 无框架依赖的原生 JS
- **Chrome APIs**:
  - `chrome.downloads` - 文件下载
  - `chrome.storage` - 本地存储
  - `chrome.runtime` - 消息通信
- **智谱AI GLM-4 API** - 对话总结

## 项目结构

```
gpt2obs/
├── manifest.json       # 扩展配置（权限、脚本注入）
├── background.js       # 后台服务：API调用、文件生成
├── content.js          # 内容脚本：DOM操作、对话抓取
├── content.css         # 注入到页面的样式
├── popup.html          # 弹窗界面
├── popup.js            # 弹窗逻辑（配置管理）
├── popup.css           # 弹窗样式
├── icons/              # 扩展图标
└── 需求规格说明书.md    # 中文需求文档
```

## 开发规范

### 代码风格
- 使用原生 JavaScript，不引入第三方框架
- 使用 `async/await` 处理异步操作
- 函数命名使用驼峰式（camelCase）
- 中文注释和文档
- 错误信息使用中文

### 消息通信
- background 和 content 之间使用 `chrome.runtime.sendMessage`
- popup 和 background 之间使用 `chrome.runtime.sendMessage`
- 消息格式：`{ action: 'xxx', data: {...} }`

### 文件命名
- 使用小写字母和连字符：`content.js`, `popup.html`
- 图标放在 `icons/` 目录

### 安全注意事项
- API Key 存储在 `chrome.storage.local`，仅本地保存
- 不要在代码中硬编码敏感信息
- 对话内容直接发送到智谱AI，不经过第三方服务器

## Chrome 扩展开发要点

### Manifest V3
- 使用 Service Worker 替代 background page
- 声明式 host_permissions
- content scripts 需要在 manifest.json 中声明

### 调试方法
1. 访问 `chrome://extensions/`
2. 开启「开发者模式」
3. 点击「加载已解压的扩展程序」
4. 修改代码后点击刷新按钮
5. 查看 background 日志：点击「Service Worker」链接
6. 查看 content script 日志：在 ChatGPT 页面打开控制台

### 权限说明
- `*://chatgpt.com/*` - ChatGPT 网页访问
- `downloads` - 保存 Markdown 文件
- `storage` - 保存 API Key 等配置

## API 调用

使用智谱AI GLM-4 API 进行对话总结：
- Endpoint: `https://open.bigmodel.cn/api/paas/v4/chat/completions`
- Prompt 需要包含总结格式要求
- 返回结构化的 Markdown 总结

## 生成的输出格式

生成的 Markdown 文件包含：
- Frontmatter（title, date, tags, source, url）
- 结构化总结（主题、问题、建议、要点）
- 完整原始对话

## 常见任务

### 修改注入样式
编辑 `content.css`，在扩展刷新后自动生效

### 调整总结格式
修改 `background.js` 中的总结 prompt 模板

### 添加新功能
1. 在 `manifest.json` 添加必要权限
2. 在对应脚本文件实现逻辑
3. 更新 popup 界面（如需要）
4. 测试功能是否正常

### 调试技巧
```javascript
// background.js 中调试
console.log('debug:', data);

// content.js 中调试
// 在 ChatGPT 页面按 F12 打开控制台

// 查看 storage
chrome.storage.local.get(null, (data) => console.log(data));
```
