# ChatGPT to Obsidian 浏览器插件需求规格说明书

## 1. 项目概述

### 1.1 项目名称
ChatGPT to Obsidian (gpt2obs)

### 1.2 项目背景
用户在ChatGPT中进行大量对话学习，但缺乏有效的知识管理和回顾机制。需要自动化工具将对话记录总结并保存到Obsidian知识库中。

### 1.3 项目目标
开发一款浏览器插件，实现一键抓取ChatGPT对话、智能总结、自动保存到Obsidian的完整流程。

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 对话内容抓取
- **优先级**：P0（必须实现）
- **描述**：从当前ChatGPT网页自动提取对话内容
- **数据源**：
  - 页面DOM结构
  - localStorage中的对话数据
- **提取内容**：
  - 对话标题
  - 所有用户消息
  - 所有助手回复
  - 对话时间戳
  - 对话ID

#### 2.1.2 智能总结
- **优先级**：P0（必须实现）
- **描述**：使用GLM-4.7 API对对话进行结构化总结
- **总结格式**：
  ```
  ## 对话主题
  [一句话概括核心主题]

  ## 我的问题
  [列出用户遇到的问题、困惑]

  ## ChatGPT的建议/解决方案
  [提炼关键建议、方法和解决方案]

  ## 关键要点
  [所有重要知识点或行动项]

  ## 对话时间
  [对话发生的时间背景]
  ```

#### 2.1.3 Obsidian保存
- **优先级**：P0（必须实现）
- **描述**：将总结和原始对话保存为Obsidian Markdown格式
- **文件格式**：
  ```markdown
  ---
  title: 对话标题
  date: 2025-01-15
  tags: [chatgpt, summary, programming]
  source: chatgpt-web
  ---

  # 📝 对话总结
  [总结内容]

  ---

  # 💬 原始对话
  [完整对话记录]
  ```
- **文件命名规则**：`YYYY-MM-DD_对话标题.md`
- **保存位置**：用户指定的Obsidian vault目录

### 2.2 辅助功能

#### 2.2.1 配置管理
- **优先级**：P1（重要）
- **配置项**：
  - GLM-4.7 API Key
  - Obsidian vault路径
  - 保存子文件夹名称（默认：ChatGPT_Summary）
  - 总结模板（可选自定义）

#### 2.2.2 批量处理
- **优先级**：P2（可选）
- **描述**：支持批量保存当前会话中的多个对话

#### 2.2.3 历史记录
- **优先级**：P2（可选）
- **描述**：显示最近保存的对话列表，支持快速访问

---

## 3. 非功能需求

### 3.1 性能要求
- API调用响应时间 < 10秒
- 页面注入脚本不延迟ChatGPT正常使用
- 支持长对话（100+轮消息）

### 3.2 安全要求
- API Key本地存储，不上传服务器
- 用户授予文件夹访问权限后才可写入文件
- 不收集任何用户数据

### 3.3 兼容性要求
- **浏览器**：Chrome 88+, Edge 88+
- **操作系统**：Windows, macOS, Linux
- **Obsidian**：任意版本（仅需文件系统访问）

### 3.4 可用性要求
- 一键操作，最少点击次数
- 清晰的进度提示和错误反馈
- 支持中英文界面

---

## 4. 技术方案

### 4.1 技术栈

| 组件 | 技术选型 |
|------|---------|
| 插件框架 | Chrome Extension Manifest V3 |
| 前端技术 | HTML5 + CSS3 + Vanilla JavaScript |
| 数据抓取 | DOM操作 + localStorage API |
| API调用 | Fetch API |
| 文件操作 | File System Access API |
| 数据存储 | chrome.storage.local |

### 4.2 架构设计

```
┌─────────────────────────────────────────────────────────┐
│                    浏览器插件架构                         │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────┐    ┌──────────────┐    ┌───────────┐ │
│  │  popup.html  │    │ content.js   │    │background │ │
│  │  (设置界面)  │    │ (页面注入)    │    │  .js      │ │
│  │              │    │              │    │ (后台服务) │ │
│  │ - API Key    │    │ - 抓取对话   │    │ - 调用API │ │
│  │ - 路径配置   │    │ - UI按钮     │    │ - 保存文件 │ │
│  │ - 历史记录   │    │ - 消息传递   │    │ - 数据存储 │ │
│  └──────────────┘    └──────────────┘    └───────────┘ │
│         │                    │                    │     │
│         └────────────────────┴────────────────────┘     │
│                      chrome.runtime                      │
└─────────────────────────────────────────────────────────┘
```

### 4.3 数据流

```
用户点击保存按钮
    ↓
content.js 抓取对话内容
    ↓
发送消息到 background.js
    ↓
background.js 调用 GLM-4.7 API
    ↓
接收总结结果
    ↓
生成 Markdown 内容
    ↓
使用 File System Access API 写入 Obsidian vault
    ↓
显示成功提示
```

### 4.4 API对接

#### GLM-4.7 API配置
```javascript
const API_CONFIG = {
  baseURL: "https://open.bigmodel.cn/api/paas/v4/chat/completions",
  model: "glm-4-plus",
  headers: {
    "Authorization": "Bearer {API_KEY}",
    "Content-Type": "application/json"
  }
}
```

#### 请求格式
```json
{
  "model": "glm-4-plus",
  "messages": [
    {"role": "system", "content": "你是对话总结助手"},
    {"role": "user", "content": "请总结以下对话..."}
  ],
  "temperature": 0.3
}
```

---

## 5. 界面设计

### 5.1 Popup设置界面

```
┌─────────────────────────────────┐
│  GPT to Obsidian    ⚙️          │
├─────────────────────────────────┤
│                                 │
│  API 配置                        │
│  ┌───────────────────────────┐  │
│  │ GLM-4.7 API Key           │  │
│  │ [sk-*******************]  │  │
│  └───────────────────────────┘  │
│                                 │
│  Obsidian 配置                   │
│  ┌───────────────────────────┐  │
│  │ Vault文件夹: [选择文件夹] │  │
│  │ 当前: E:\Obsidian\vault   │  │
│  └───────────────────────────┘  │
│  ┌───────────────────────────┐  │
│  │ 保存子目录: [ChatGPT_Summary]│
│  └───────────────────────────┘  │
│                                 │
│  [💾 保存当前对话]               │
│                                 │
│  最近保存                        │
│  • 如何学习Python (2分钟前)      │
│  • 调试代码问题 (1小时前)        │
│                                 │
└─────────────────────────────────┘
```

### 5.2 页面悬浮按钮

```
┌─────────────┐
│  💾 保存对话  │  ← 点击悬浮在ChatGPT页面右上角
└─────────────┘
```

---

## 6. 实现计划

### 6.1 开发阶段

| 阶段 | 任务 | 预计工作量 |
|------|------|-----------|
| 第一阶段 | 项目搭建 + manifest配置 | 0.5天 |
| 第二阶段 | content.js 对话抓取功能 | 1天 |
| 第三阶段 | background.js API调用 | 0.5天 |
| 第四阶段 | File System Access API集成 | 1天 |
| 第五阶段 | Popup界面开发 | 0.5天 |
| 第六阶段 | 测试与优化 | 0.5天 |

**总计**：4天

### 6.2 里程碑

- M1: 基础框架搭建完成
- M2: 能够抓取对话内容
- M3: API调用成功并返回总结
- M4: 文件成功保存到Obsidian
- M5: 完整功能可用

---

## 7. 风险与挑战

### 7.1 技术风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| ChatGPT DOM结构变化 | 抓取失败 | 定期维护更新选择器 |
| API调用频率限制 | 总结失败 | 添加重试机制和错误提示 |
| File System Access API兼容性 | 部分浏览器不可用 | 提供降级方案（本地服务器） |

### 7.2 业务风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| API Key泄露 | 安全问题 | 本地存储加密，明文警告 |
| 用户vault路径错误 | 文件丢失 | 写入前验证路径有效性 |

---

## 8. 验收标准

### 8.1 功能验收

- [x] 能够从ChatGPT页面抓取完整对话
- [x] API调用成功返回结构化总结
- [x] 文件正确保存到Obsidian指定目录
- [x] Markdown格式在Obsidian中正常显示

### 8.2 质量验收

- [x] 无控制台错误
- [x] 操作响应时间 < 3秒（不含API）
- [x] 支持长对话（100+轮）
- [x] 错误提示清晰明确

---

## 9. 后续迭代

### 9.1 V1.1 计划
- 支持自定义总结模板
- 支持批量保存历史对话
- 添加标签自动分类功能

### 9.2 V2.0 计划
- 支持其他AI平台（Claude、文心一言）
- 双向链接智能推荐
- Obsidian插件版本（无需浏览器）

---

## 10. 附录

### 10.1 参考文档
- [Chrome Extension Manifest V3](https://developer.chrome.com/docs/extensions/mv3/)
- [File System Access API](https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API)
- [智谱AI开放平台文档](https://open.bigmodel.cn/dev/api)

### 10.2 更新日志
- 2025-02-26: 初始版本创建
